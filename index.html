<!DOCTYPE html>
<html>
<head>
    <title>Agromagna.org - Lista di commercianti</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <style>
        body {
            display: flex;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f8ff;
            font-family: Arial, sans-serif;
        }
        .commerciante {
            display: flex;
            align-items: center;
            background-color: #fff;
            border: 1px solid #ddd;
            margin-bottom: 10px;
			padding-left: 20px;
            width: 100%;
        }
        .logo {
            width: 100px;
            height: 100px;
            margin-right: 20px;
        }
        .bitcoin {
            border-color: #f90;
        }
        .info {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>
<body>
    <div><center><b><font size="6">Agromagna</font></b></center><br>Questa è una vetrina di commercianti come contadini, allevatori, fungaioli, che vendono vari tipi di prodotti in Romagna a km0.<br>
	    Vanno bene anche le varie bancarelle in giro e nelle piazze, l'importante è che siano direttamente loro a venderli, senza intermediari.<br>
        Si può anche vendere con spedizioni, anche qui il contatto deve essere sempre diretto con il produttore, cioè che si possa conoscerlo faccia a faccia.<br>
        La pagina ad ogni apertura carica la lista dei commercianti in modo randomico, non dando quindi alcun vantaggio particolare.<br>
        L'unico vantaggio è per i commercianti che accettano "anche" Bitcoin come mezzo di pagamento, che vengono messi in evidenza rispetto agli altri.<br>
        La pagina è mantenuta gratuitamente, senza alcuna fonte di ricavo. Non forniamo quindi alcuna garanzia sui commercianti e i loro prodotti.<br>
        Email: <a href="mailto:agromagna@proton.me">agromagna@proton.me</a> - Chat: <a href="https://tawk.to/agromagna" target="_blank">Agromagna</a> - Canale News Telegram: <a href="https://t.me/agromagna" target="_blank">https://t.me/agromagna</a> <b>Segnalateci altri commercianti :)</b><br><br>
	    <b>Consiglio: alle volte alcuni prodotti richiedono una gestione particolare, ad esempio per il trasporto, o non sono disponibili.<br>
	    Per questo è sempre meglio contattare prima il venditore per ricevere maggiori informazioni e concordare con lui.</b><br><br>
        Filtra per prodotto <select id="filtroProdotti" onchange="filtraGenerale()">
            <!-- Le opzioni saranno aggiunte dinamicamente -->
        </select>
        <!--<button onclick="filtraProdotti()">Prodotto</button>-->
		Province: <select id="filtroProvince" onchange="filtraGenerale()">
            <!-- Le opzioni saranno aggiunte dinamicamente -->
        </select>
        <!--<button onclick="filtraProvince()">Provincia</button>-->
        Pagamento: <select id="filtroPagamenti" onchange="filtraGenerale()">
            <!-- Le opzioni saranno aggiunte dinamicamente -->
        </select>
        <!--<button onclick="filtraPagamenti()">Pagamento</button>-->
        <button onclick="reloadPage()">Annulla filtri</button>
        <div id="listaCommercianti"></div>
    </div>

    <script>



var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/64e891d894cf5d49dc6c73b5/1h8m7jdg3';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();


        var commercianti = [];

        function filtraGenerale() {
            var filtroProd = document.getElementById('filtroProdotti').value;
            var filtroProv = document.getElementById('filtroProvince').value;
            var filtroPaga = document.getElementById('filtroPagamenti').value;

            var commerciantiFiltrati = commercianti;

            
            if (filtroProd != "Tutti") {
                commerciantiFiltrati = commercianti.filter(function(commerciante) {
                    return commerciante.prodotti.includes(filtroProd);
                });
                
            }

            if (filtroPaga != "Tutti") {
                commerciantiFiltrati = commerciantiFiltrati.filter(function(commerciante) {
                    return commerciante.sistemiPagamento.includes(filtroPaga);
                });
            }

            if (filtroProv != "Tutte") {
                commerciantiFiltrati = commerciantiFiltrati.filter(function(commerciante) {
                    return commerciante.indirizzo.province.includes(filtroProv);
                });
            }

            mostraCommercianti(commerciantiFiltrati);
            ordina();
        }

        function ordina() {
            commercianti.sort(function(a, b) {
                if (a.sistemiPagamento.includes('Bitcoin') && !b.sistemiPagamento.includes('Bitcoin')) {
                    return -1;
                }
                if (!a.sistemiPagamento.includes('Bitcoin') && b.sistemiPagamento.includes('Bitcoin')) {
                    return 1;
                }
                return 0.5 - Math.random();
            });
        }

        function popolaFiltroProdotti() {
            var filtroSelect = document.getElementById('filtroProdotti');
            var prodotti = [];
            commercianti.forEach(function(commerciante) {
                commerciante.prodotti.forEach(function(prodotto) {
                    if (!prodotti.includes(prodotto)) {
                        prodotti.push(prodotto);
                    }
                });
            });
            prodotti.sort();
            prodotti.unshift("Tutti");
            prodotti.forEach(function(prodotto) {
                var option = document.createElement('option');
                option.value = prodotto;
                option.textContent = prodotto;
                filtroSelect.appendChild(option);
            });
        }
		
        function popolaFiltroPagamenti() {
            var filtroSelect = document.getElementById('filtroPagamenti');
            var pagamenti = [];
            commercianti.forEach(function(commerciante) {
                commerciante.sistemiPagamento.forEach(function(pagamento) {
                    if (!pagamenti.includes(pagamento)) {
                        pagamenti.push(pagamento);
                    }
                });
            });
            pagamenti.sort();
            pagamenti.unshift("Tutti");
            pagamenti.forEach(function(pagamento) {
                var option = document.createElement('option');
                option.value = pagamento;
                option.textContent = pagamento;
                filtroSelect.appendChild(option);
            });
        }

		function popolaFiltroProvince() {
            var filtroSelect = document.getElementById('filtroProvince');
            var province = [];
            commercianti.forEach(function(commerciante) {
		if (!province.includes(commerciante.indirizzo.province)) {
                	province.push(commerciante.indirizzo.province);
                }	 
            });
            province.sort();
            province.unshift("Tutte");
            province.forEach(function(provincia) {
                var option = document.createElement('option');
                option.value = provincia;
                option.textContent = provincia;
                filtroSelect.appendChild(option);
            });
        }

        function mostraCommercianti(commercianti) {
            var listaCommerciantiDiv = document.getElementById('listaCommercianti');
            listaCommerciantiDiv.innerHTML = '';

            commercianti.forEach(function(commerciante) {
                var commercianteDiv = document.createElement('div');
                commercianteDiv.className = 'commerciante';

                if (commerciante.sistemiPagamento.includes('Bitcoin')) {
                    commercianteDiv.classList.add('bitcoin');
                }

                var logoImg = document.createElement('img');
                logoImg.className = 'logo';
                logoImg.src = "loghi/" + commerciante.logo;
                commercianteDiv.appendChild(logoImg);

                var infoDiv = document.createElement('div');

                var nomeH2 = document.createElement('h2');
                nomeH2.textContent = commerciante.nome;
                infoDiv.appendChild(nomeH2);

                var prodottiH3 = document.createElement('h3');
                prodottiH3.textContent = 'Prodotti: ' + commerciante.prodotti.join(', ');
                prodottiH3.className = 'info';
                infoDiv.appendChild(prodottiH3);

                var sistemiPagamentoH3 = document.createElement('h3');
                sistemiPagamentoH3.textContent = 'Sistemi di Pagamento: ' + commerciante.sistemiPagamento.join(', ');
                sistemiPagamentoH3.className = 'info';
                infoDiv.appendChild(sistemiPagamentoH3);

                var indirizzoH3 = document.createElement('h3');
                indirizzoH3.textContent = 'Indirizzo: ' + commerciante.indirizzo.base + ', Provincia: ' + commerciante.indirizzo.province;
                indirizzoH3.className = 'info';
                infoDiv.appendChild(indirizzoH3);

                var contattiH3 = document.createElement('h3');
                contattiH3.textContent = 'Contatti: ';
                contattiH3.className = 'info';
                infoDiv.appendChild(contattiH3);

                if (commerciante.contatti.telefono !="") {
                    var telefonoLink = document.createElement('a');
                    telefonoLink.setAttribute('href', "tel:+39" + commerciante.contatti.telefono);
                    telefonoLink.textContent = commerciante.contatti.telefono;
                    contattiH3.appendChild(telefonoLink);
                    contattiH3.append(" ");
                }

                if (commerciante.contatti.telefono2 !="") {
                    var telefonoLink = document.createElement('a');
                    telefonoLink.setAttribute('href', "tel:+39" + commerciante.contatti.telefono2);
                    telefonoLink.textContent = commerciante.contatti.telefono2;
                    contattiH3.appendChild(telefonoLink);
                    contattiH3.append(" ");
                }
                
                if (commerciante.contatti.email !="") {
                    var emailLink = document.createElement('a');
                    emailLink.setAttribute('href', "mailto:" + commerciante.contatti.email);
                    emailLink.textContent = "Email";
                    contattiH3.appendChild(emailLink);
                    contattiH3.append(" ");
                }

                if (commerciante.contatti.sito != "") {
                    var sito = document.createElement('a');
                    sito.setAttribute('href', commerciante.sito);
                    sito.setAttribute('target', '_blank')
                    sito.textContent = "Sito";
                    infoDiv.appendChild(sito);
                    contattiH3.appendChild(sito);
                    contattiH3.append(" ");
                }

                if (commerciante.contatti.sito2 != "") {
                    var sito = document.createElement('a');
                    sito.setAttribute('href', commerciante.sito2);
                    sito.setAttribute('target', '_blank')
                    sito.textContent = "Sito 2";
                    infoDiv.appendChild(sito);
                    contattiH3.appendChild(sito);
                    contattiH3.append(" ");
                }

                commercianteDiv.appendChild(infoDiv);
                listaCommerciantiDiv.appendChild(commercianteDiv);
            });
        }
	  

    //fetch('https://raw.githubusercontent.com/agromagna/agromagna.github.io/master/comm.csv') 
    fetch('comm.csv') 
        .then(response => response.text())
        .then(data => {
            var rows = data.split('\n');
            rows.slice(0,rows.length-1).forEach(row => {
                var columns = row.split(',');
                commercianti.push({
                    nome: columns[0],
                    logo: columns[1],
                    prodotti: columns[2].split('|'),
                    sistemiPagamento: columns[3].split('|'),
                    indirizzo: {
			base: columns[4],
			province: columns[5]
			},
                    contatti: {
                        telefono: columns[6],
                        telefono2: columns[7],
                        email: columns[8]
                    },
                    sito: columns[9],
                    sito2: columns[10]
                });
           });
        
            // Funzioni per mostrare i commercianti, popolare il filtro, ecc.

            
        ordina();
        popolaFiltroProdotti();
	    popolaFiltroProvince();
        popolaFiltroPagamenti();
        mostraCommercianti(commercianti);
        
    });

    function reloadPage() {
            document.getElementById("filtroProdotti").selectedIndex = 0;
            document.getElementById("filtroProvince").selectedIndex = 0;
            document.getElementById("filtroPagamenti").selectedIndex = 0;
            mostraCommercianti(commercianti);
            ordina();
    }
    </script>
</body>
</html>
